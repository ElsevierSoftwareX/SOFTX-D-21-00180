<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: temporal-plugins-server/CSTNU/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: temporal-plugins-server/CSTNU/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module  temporal-plugins-server/CSTNU

@description
 * This module contains the functionability to execute 
 * the Java application CSTNU to verify the dynamic controlability 
 * of Constraint Simple Temporal networks with Uncertainty. 
 * &lt;br>
 * This module corrspond to the server part of a plugin for the tool TimeAwareBPMN-js
 * &lt;br>
 * The module exports an object moduleInfo, that contains 
 * information about the module and allows the tool the execution  
 * functions that receive the objects request and response from a
 * HTTP request perfomed with method POST to the url server/moduleURL/functionURL
 * from the complement of the plugin in the client. 
 * &lt;br>&lt;br>
 * Example of the object moduleInfo to export:&lt;br>
 * &lt;pre>
 * const moduleInfo = {
 *     name: 'pluginName',
 *     url: '/moduleURL',
 *     postRequests: [{
 *         url: '/function01URL',
 *         function: function01Toexecute,
 *     },
 *     {
 *         url: '/function02URL',
 *         function: function02Toexecute,
 *     }]
 * };
 * &lt;/pre>
 */

// Specific requirments for the module to execute a Java tool  
const java = require("java");

java.options.push('-Xms2G');
java.options.push('-Xmx4G');
java.options.push('-Djava.util.logging.config.file=nologging.properties');
java.classpath.push("./temporal-plugins-server/CSTNU/javaRep/CSTNU-Tool-4.1.jar");


/** 
 * moduleInfo object 
 * @description JS object to export. It contains information of the module and 
 * functions to execute.
 * @type {{ name: string,url: string,  postRequests: Array }}
 */
const moduleInfo = {
    name: 'CSTNU',
    url: '/cstnu',
    postRequests: [{
        url: '/dcChecking',
        function: checkDynamicControllability,
    }]
};

module.exports = { moduleInfo };

/**
 * Exeute the verification or checking with the Java tool CSTNU
 * @param {Object} request http request object 
 * @param {Object} response http response object
 */
function checkDynamicControllability(request, response) {
    var body = '';

    request.on('data', function (data) {
        body += data;
    });

    request.on('end', function () {

        let cstnuEvaluation, cstnuChecked;

        // Object to be returned
        let jsonRes = {
            cstnuEvaluation: '',
            cstnuChecked: '',
            status: "error",
            error: ''
        };

        try {
            // Crete an instance of the CSTNU tool
            let cstnu = java.newInstanceSync("it.univr.di.cstnu.algorithms.CSTNU", body);
            // Execute the verification or checking
            let status = cstnu.dynamicControllabilityCheckSync();

            cstnuEvaluation = { consistency: status.consistency };

            // Get the negative loop, is there is any
            if (status.negativeLoopNode != null)
                cstnuEvaluation.negativeLoopNode = status.negativeLoopNode.toString();

            // Get the optimized graph 
            cstnuChecked = cstnu.getGCheckedAsGraphMLSync();

            console.log('Packing results in JSON');

            jsonRes = {
                cstnuEvaluation: JSON.stringify(cstnuEvaluation),
                cstnuChecked: String(cstnuChecked),
                status: "ok",
                error: ''
            };

        } catch (error) {
            // In case of error return this information 
            console.log('error');
            console.log(error.message);
            jsonRes.error = String(error.message);
        }

        response.writeHead(200, { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' });
        response.end(JSON.stringify(jsonRes));
    });

}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">TimeAwareBPMN-js</a></h2><h3>Modules</h3><ul><li><a href="module-serverNodeJs.html">serverNodeJs</a></li><li><a href="module-temporal-plugins-client.html">temporal-plugins-client</a></li><li><a href="module-temporal-plugins-client_CSTNU.html">temporal-plugins-client/CSTNU</a></li><li><a href="module-temporal-plugins-client_CSTNU_bpmn2cstnu.html">temporal-plugins-client/CSTNU/bpmn2cstnu</a></li><li><a href="module-temporal-plugins-client_CSTNU_bpmnSetcstnuLabels.html">temporal-plugins-client/CSTNU/bpmnSetcstnuLabels</a></li><li><a href="module-temporal-plugins-client_CSTNU_cstnuChecked.html">temporal-plugins-client/CSTNU/cstnuChecked</a></li><li><a href="module-temporal-plugins-server.html">temporal-plugins-server</a></li><li><a href="module-temporal-plugins-server_CSTNU.html">temporal-plugins-server/CSTNU</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-TA_BPMN_editor.html">TimeAwareBPMN-editor</a></li><li><a href="tutorial-index_.html">TimeAwareBPMN-js</a></li><li><a href="tutorial-temporal-plugins-client.html">Client-side plug-in</a></li><li><a href="tutorial-temporal-plugins-server.html">Server-side plug-in</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Mon Sep 27 2021 15:26:02 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
